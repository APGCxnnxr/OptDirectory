<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Example Game â€” Launcher API demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>body{font-family:system-ui;padding:18px} button{padding:8px 10px;margin-right:6px}</style>
</head>
<body>
  <h1>Example Game</h1>
  <p>This demonstrates saving and account access via the launcher.</p>
  <div>Counter: <span id="c">0</span></div>
  <button id="inc">+1</button>
  <button id="save">Save</button>
  <button id="load">Load</button>
  <button id="getAccount">Get Account</button>
  <button id="spend">Spend 1 coin</button>
  <pre id="log"></pre>

  <script>
    const logEl = document.getElementById('log');
    function log(s){ logEl.textContent += s + "\\n"; }

    let counter = 0;
    document.getElementById('inc').onclick = ()=> { counter++; document.getElementById('c').textContent = counter; };

    document.getElementById('save').onclick = ()=> {
      parent.postMessage({ type:'launcher.save', slot:'default', data:{ counter } }, '*');
      log('Requested save');
    };
    document.getElementById('load').onclick = ()=> {
      const rid = 'r'+Date.now();
      parent.postMessage({ type:'launcher.load', slot:'default', requestId:rid }, '*');
      log('Requested load');
    };

    document.getElementById('getAccount').onclick = ()=> {
      parent.postMessage({ type:'account.get' }, '*');
      log('Requested account info');
    };

    document.getElementById('spend').onclick = ()=> {
      const rid = 'spend'+Date.now();
      parent.postMessage({ type:'account.spend', amount:1, requestId:rid }, '*');
      log('Requested spend 1 coin');
    };

    window.addEventListener('message', (ev) => {
      const m = ev.data || {};
      if (!m || typeof m !== 'object') return;
      if (m.type === 'launcher.init') {
        log('Launcher init: saves=' + JSON.stringify(Object.keys(m.saves||{})) + ', account=' + JSON.stringify(m.account||{}));
        if (m.saves && m.saves.default) {
          counter = m.saves.default.counter || 0;
          document.getElementById('c').textContent = counter;
          log('Applied init save');
        }
      } else if (m.type === 'launcher.load.response') {
        log('Load response: ' + JSON.stringify(m.data));
        if (m.data && typeof m.data.counter === 'number') {
          counter = m.data.counter; document.getElementById('c').textContent = counter;
        }
      } else if (m.type === 'launcher.save.ack') {
        log('Save acknowledged');
      } else if (m.type === 'account.info') {
        log('Account: ' + JSON.stringify(m.account));
      } else if (m.type === 'account.spend.response') {
        log('Spend response: success=' + m.success + ', account=' + JSON.stringify(m.account));
      } else if (m.type === 'account.update') {
        log('Account updated: ' + JSON.stringify(m.account));
      }
    });
  </script>
</body>
</html>
